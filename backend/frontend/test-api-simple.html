<!DOCTYPE html>
<html>
<head>
    <title>üîß Simple API Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß VidPOD API Direct Test</h1>
    
    <div>
        <h2>Step 1: Authentication</h2>
        <button onclick="testLogin()">üîê Test Login</button>
        <div id="authResult" class="result"></div>
    </div>
    
    <div>
        <h2>Step 2: API Tests</h2>
        <button onclick="testTags()">üè∑Ô∏è Test Tags API</button>
        <button onclick="testPendingStories()">üìñ Test Pending Stories</button>
        <div id="apiResults" class="result"></div>
    </div>
    
    <div>
        <h2>Step 3: DOM Test</h2>
        <button onclick="testDOMElements()">üîç Test DOM Elements</button>
        <div id="domResults" class="result"></div>
        
        <!-- Test elements like those in admin panel -->
        <div id="tagsList">Tags will appear here</div>
        <table><tbody id="storiesApprovalTable">Stories will appear here</tbody></table>
    </div>

    <script>
        const API_URL = 'https://podcast-stories-production.up.railway.app/api';
        let authToken = null;

        async function testLogin() {
            const resultDiv = document.getElementById('authResult');
            resultDiv.innerHTML = '<div>üîÑ Testing login...</div>';
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@vidpod.com',
                        password: 'vidpod'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <div>‚úÖ Login successful!</div>
                        <pre>User: ${data.user.email}
Role: ${data.user.role}
Token: ${data.token.substring(0, 50)}...</pre>
                    `;
                    
                    // Store token like real admin panel
                    localStorage.setItem('token', authToken);
                } else {
                    const error = await response.text();
                    throw new Error(`Login failed: ${response.status} - ${error}`);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå Login error: ${error.message}`;
            }
        }

        async function testTags() {
            const resultDiv = document.getElementById('apiResults');
            if (!authToken) {
                authToken = localStorage.getItem('token');
                if (!authToken) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '‚ùå No auth token. Please login first.';
                    return;
                }
            }
            
            resultDiv.innerHTML += '<div>üîÑ Testing Tags API...</div>';
            
            try {
                const response = await fetch(`${API_URL}/tags`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const tags = await response.json();
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML += `
                        <div>‚úÖ Tags API successful! Found ${tags.length} tags</div>
                        <pre>${JSON.stringify(tags, null, 2)}</pre>
                    `;
                    
                    // Display tags in DOM test element
                    const tagsList = document.getElementById('tagsList');
                    tagsList.innerHTML = `<h4>Tags Loaded (${tags.length}):</h4>` +
                        tags.map(tag => `<span style="background:#e3f2fd;padding:4px 8px;margin:2px;border-radius:4px;display:inline-block;">${tag.tag_name}</span>`).join('');
                    
                } else {
                    const error = await response.text();
                    throw new Error(`Tags API failed: ${response.status} - ${error}`);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML += `‚ùå Tags API error: ${error.message}`;
            }
        }

        async function testPendingStories() {
            const resultDiv = document.getElementById('apiResults');
            if (!authToken) {
                authToken = localStorage.getItem('token');
                if (!authToken) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = '‚ùå No auth token. Please login first.';
                    return;
                }
            }
            
            resultDiv.innerHTML += '<div>üîÑ Testing Pending Stories API...</div>';
            
            try {
                const response = await fetch(`${API_URL}/stories/admin/by-status/pending`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const stories = await response.json();
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML += `
                        <div>‚úÖ Pending Stories API successful! Found ${stories.length} stories</div>
                        <pre>${JSON.stringify(stories, null, 2)}</pre>
                    `;
                    
                    // Display stories in DOM test element
                    const storiesTable = document.getElementById('storiesApprovalTable');
                    if (stories.length > 0) {
                        storiesTable.innerHTML = stories.map(story => `
                            <tr>
                                <td>${story.id}</td>
                                <td>${story.idea_title}</td>
                                <td>${story.approval_status}</td>
                                <td>${story.uploaded_by_name}</td>
                            </tr>
                        `).join('');
                    } else {
                        storiesTable.innerHTML = '<tr><td colspan="4">No pending stories</td></tr>';
                    }
                    
                } else {
                    const error = await response.text();
                    throw new Error(`Pending Stories API failed: ${response.status} - ${error}`);
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML += `‚ùå Pending Stories API error: ${error.message}`;
            }
        }

        function testDOMElements() {
            const resultDiv = document.getElementById('domResults');
            const elements = ['tagsList', 'storiesApprovalTable'];
            let results = '<div>üîç Checking DOM elements...</div>';
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    results += `<div>‚úÖ Element '${id}' found: ${element.tagName}</div>`;
                } else {
                    results += `<div>‚ùå Element '${id}' NOT found</div>`;
                }
            });
            
            resultDiv.innerHTML = results;
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            console.log('Simple API test page loaded');
            
            // Check for existing token
            const existingToken = localStorage.getItem('token');
            if (existingToken) {
                authToken = existingToken;
                document.getElementById('authResult').innerHTML = `
                    <div class="result success">‚úÖ Found existing auth token</div>
                `;
            }
        });
    </script>
</body>
</html>